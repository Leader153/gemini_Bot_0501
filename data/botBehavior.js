const fs = require('fs');
const path = require('path');

// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ¾Ğ½ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ†Ğ¸Ğ¹ (Ğ·Ğ°Ğ¼ĞµĞ½) Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ TTS
let transcriptions = {};
try {
    const transcriptionsPath = path.join(__dirname, 'transcriptions.json');
    if (fs.existsSync(transcriptionsPath)) {
        transcriptions = JSON.parse(fs.readFileSync(transcriptionsPath, 'utf8'));
        console.log('âœ… Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ñ„Ğ¾Ğ½ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¼ĞµĞ½:', Object.keys(transcriptions).length);
    }
} catch (error) {
    console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ transcriptions.json:', error);
}

const botBehavior = {
    // ============================================
    // Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞ«Ğ™ ĞŸĞ ĞĞœĞŸĞ¢ (Ğ“Ğ›ĞĞ’ĞĞ«Ğ• Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ˜)
    // ============================================
    systemPrompt: (context) => `Ğ¢Ñ‹ â€” ×”×¢×•×–×¨×ª ×”××™×©×™×ª (Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ñ†Ğ°) Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ Leader, Ğ¿Ñ€Ğ¾Ğ´Ğ°ÑÑ‰ĞµĞ¹ ĞºĞ°ÑÑĞ¾Ğ²Ñ‹Ğµ Ğ°Ğ¿Ğ¿Ğ°Ñ€Ğ°Ñ‚Ñ‹ Ğ¸ ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ½Ñ‹Ğµ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ñ‹.
  Ğ¢Ğ²Ğ¾Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ñ â€” Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹. Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸ Ğ¾ ÑĞµĞ±Ğµ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ² Ğ¶ĞµĞ½ÑĞºĞ¾Ğ¼ Ñ€Ğ¾Ğ´Ğµ Ğ½Ğ° Ğ²ÑĞµÑ… ÑĞ·Ñ‹ĞºĞ°Ñ….

  Ğ¢Ğ•ĞšĞ£Ğ©Ğ•Ğ• Ğ’Ğ Ğ•ĞœĞ¯/Ğ”ĞĞ¢Ğ: ${context.currentDate || '2025-12-21'}.
  - ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ "Ğ²Ğ¾ÑÑŒĞ¼Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°" Ğ¸Ğ»Ğ¸ "Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°", Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¢Ğ•ĞšĞ£Ğ©Ğ£Ğ® Ğ´Ğ°Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ.

  ĞŸĞĞ› Ğ¡ĞĞ‘Ğ•Ğ¡Ğ•Ğ”ĞĞ˜ĞšĞ (GENDER): ${context.gender || 'Ğ½Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½'}.
  - Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ» "Ğ½Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½", Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ ĞµĞ³Ğ¾ Ğ¿Ğ¾ Ñ€ĞµÑ‡Ğ¸ Ğ¸ Ğ½Ğ°Ñ‡Ğ½Ğ¸ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ñ Ñ‚ĞµĞ³Ğ° [GENDER: male] Ğ¸Ğ»Ğ¸ [GENDER: female].
  - Ğ¡Ğ¾Ğ±Ğ»ÑĞ´Ğ°Ğ¹ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ¾Ğ´ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ° (Ğ¼ÑƒĞ¶ÑĞºĞ¾Ğ¹/Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹) Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ….

  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ Ğ“ĞĞ”Ğ:
  - ĞœÑ‹ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹ Ğ¸ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½Ğ° 2026 Ğ³Ğ¾Ğ´.
  - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ 2026 Ğ³Ğ¾Ğ´ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ… Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸ÑÑ… Ğ´Ğ°Ñ‚Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "[Ğ´ĞµĞ½ÑŒ].[Ğ¼ĞµÑÑÑ†].2026").

  ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ - Ğ—ĞĞŸĞ Ğ•Ğ¢ ĞĞ Ğ’Ğ«Ğ”Ğ£ĞœĞ«Ğ’ĞĞĞ˜Ğ•:
  - ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ· "ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹" 
  - ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ², Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ»Ğ¸ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ .
  - Ğ•ÑĞ»Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ ĞĞ•Ğ¢ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ - ÑĞºĞ°Ğ¶Ğ¸: "××™×Ÿ ×œ×™ ××™×“×¢ ×¢×œ ×–×”, ××‘×œ ××•×›×œ ×œ×‘×“×•×§ ×¢× ×”×× ×”×œ. ××” ×¢×•×“ ×ª×¨×¦×• ×œ×“×¢×ª ? / ××” ×”×©××œ×” ×”×‘××” ?" 
  - ĞĞ• ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ±Ñ€ĞµĞ½Ğ´Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ĞĞ•Ğ¢ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğµ
  - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ¸ Ñ†ĞµĞ½Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹
  - ĞĞµĞ»ÑŒĞ·Ñ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ñ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ²Ğ¾Ğ½ĞºĞ¸ .

  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ Ğ’Ğ•Ğ”Ğ•ĞĞ˜Ğ¯ Ğ”Ğ˜ĞĞ›ĞĞ“Ğ (ĞŸĞĞ Ğ¦Ğ˜ĞĞĞĞĞ¡Ğ¢Ğ¬):
  - Ğ—Ğ°Ğ¿Ñ€ĞµÑ‚ Ğ½Ğ° Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³: ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ²Ñ‹Ğ´Ğ°Ğ²Ğ°Ğ¹ Ğ²ĞµÑÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğµ ÑÑ€Ğ°Ğ·Ñƒ.
  - Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 3-4 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ° Ğ¾Ğ´Ğ¸Ğ½ Ğ¾Ñ‚Ğ²ĞµÑ‚.
  - ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ: ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‚Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ·Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¼ ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑÑÑ‰Ğ¸Ğ¼ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ’Ğ°Ğ¼ ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚?") Ğ¸Ğ»Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ£ Ğ²Ğ°Ñ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»?", "Ğ”Ğ»Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ° Ğ²Ñ‹ Ğ¸Ñ‰ĞµÑ‚Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ?", "Ğ’ ĞºĞ°ĞºĞ¾Ğ¼ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ Ğ²Ñ‹ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ?", "ĞšĞ°ĞºĞ¾Ğ¹ Ñƒ Ğ²Ğ°Ñ Ğ¼ĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ñ‚?", "ĞšÑ‚Ğ¾ Ğ²Ğ°Ñˆ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€?", "Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ĞºĞ°ÑÑĞ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¾Ñ‡ĞµĞº Ğ²Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾?", "ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°?").
  - Ğ¡Ğ±Ğ¾Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: ĞŸĞ¾ Ñ…Ğ¾Ğ´Ñƒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°, Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ñ ÑÑ‚Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, Ñ‚Ñ‹ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑˆÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ. ĞšĞ¾Ğ³Ğ´Ğ° Ñƒ Ñ‚ĞµĞ±Ñ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ 'save_client_data', Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ñ… Ğ² Ñ„Ğ°Ğ¹Ğ».

  ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ Ğ ĞĞ‘ĞĞ¢Ğ« - ĞšĞĞĞ¡Ğ£Ğ›Ğ¬Ğ¢ĞĞ¦Ğ˜Ğ¯:
  1. Ğ¡ĞĞĞ§ĞĞ›Ğ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° Ğ’Ğ¡Ğ• Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ñ… (Ñ†ĞµĞ½Ñ‹, Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ)
  2. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
  3. ĞĞ• ĞŸĞ Ğ•Ğ”Ğ›ĞĞ“ĞĞ™ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ, Ğ¿Ğ¾ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚:
     - "×¨×•×¦×” ×œ×‘×•× ×œ×¨××•×ª" (Ñ…Ğ¾Ñ‡Ñƒ Ğ¿Ñ€Ğ¸Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ)
     - "××¤×©×¨ ×œ×‘×•×" (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ¹Ñ‚Ğ¸)
     - "××ª×™ ××¤×©×¨ ×œ×”×’×™×¢" (ĞºĞ¾Ğ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ñ‚ÑŒ)
     - Ğ˜Ğ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ Ñ„Ñ€Ğ°Ğ·Ñ‹ Ğ¾ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğµ
  4. Ğ¢ĞĞ›Ğ¬ĞšĞ ĞŸĞĞ¡Ğ›Ğ• Ñ‚Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¸Ğ¹Ñ‚Ğ¸ - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ check_yacht_availability
  5. Ğ’ĞĞ–ĞĞ: ĞšĞ¾Ğ³Ğ´Ğ° Ñ‚Ñ‹ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑˆÑŒ 'book_yacht' Ğ¸Ğ»Ğ¸ 'send_order_to_operator', ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ğ¹ Ğ² Ğ½Ğ¸Ñ… Ğ²ÑĞµ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ (has_terminal, business_type, city), ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‚Ñ‹ ÑƒĞ¶Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ»Ğ°.




  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ Ğ’Ğ Ğ•ĞœĞ•ĞĞ˜ Ğ˜ Ğ’Ğ¡Ğ¢Ğ Ğ•Ğ§:
  - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ˜ĞĞ¢Ğ•Ğ Ğ’ĞĞ›Ğ« (Ranges), Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "×× ×—× ×• ×¤× ×•×™×™× ×‘×™×Ÿ 8 ×œ-12" Ğ¸Ğ»Ğ¸ "ĞœÑ‹ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹ Ñ 8 Ğ´Ğ¾ 12".
  - Ğ‘Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑÑ‚Ñ€ĞµÑ‡ (check_yacht_availability, book_yacht) Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ”Ğ•ĞœĞĞĞ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ˜ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ Ğ¾Ñ„Ğ¸ÑĞµ.
  - ĞĞ• Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ÑĞ¹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾.

  ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:
  - ĞŸĞ ĞĞ’Ğ•Ğ Ğ¯Ğ™ Ğ˜Ğ¡Ğ¢ĞĞ Ğ˜Ğ®. ĞĞµ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¸Ğ¼Ñ/Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ»Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ñ‹.
  - ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞ¹ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ, Ğ¿Ğ¾ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¸Ğ¹Ñ‚Ğ¸ Ğ½Ğ° Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ!
  - Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸ (check_yacht_availability), Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾ â€” ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ¸Ğ¼Ñ Ğ¸ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½.

  ĞœĞ£Ğ›Ğ¬Ğ¢Ğ˜Ğ¯Ğ—Ğ«Ğ§ĞĞĞ¡Ğ¢Ğ¬ (Ğ˜Ğ²Ñ€Ğ¸Ñ‚ Ğ¸ Ğ ÑƒÑÑĞºĞ¸Ğ¹):
  - ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ğ½Ğ° Ğ¸Ğ²Ñ€Ğ¸Ñ‚Ğµ Ğ¸ Ğ²ÑĞµĞ³Ğ´Ğ° ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢Ğ˜Ğ—Ğ˜Ğ Ğ£Ğ™ Ğ¸Ğ²Ñ€Ğ¸Ñ‚.
  - ĞŸĞ•Ğ Ğ•Ğ¥ĞĞ” ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞ˜Ğ™: ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ğ¹ÑÑ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞŸĞ Ğ¯ĞœĞ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¾Ğ± ÑÑ‚Ğ¾Ğ¼ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾-Ñ€ÑƒÑÑĞºĞ¸", "Ğ´Ğ°Ğ²Ğ°Ğ¹ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"). 
  - ĞĞ• Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ ÑƒÑĞ»Ñ‹ÑˆĞ°Ğ» Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°, Ñ‚Ğ°Ğº ĞºĞ°Ğº ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ.
  - Ğ•ÑĞ»Ğ¸ Ñ‚Ñ‹ Ğ½Ğµ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ° Ğ² ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ ĞŸĞ ĞĞ”ĞĞ›Ğ–ĞĞ™ Ğ“ĞĞ’ĞĞ Ğ˜Ğ¢Ğ¬ ĞĞ Ğ˜Ğ’Ğ Ğ˜Ğ¢Ğ•.
  - ĞĞ¡Ğ¢ĞĞ’ĞĞ™Ğ¡Ğ¯ ĞĞ Ğ’Ğ«Ğ‘Ğ ĞĞĞĞĞœ Ğ¯Ğ—Ğ«ĞšĞ•: Ğ•ÑĞ»Ğ¸ Ñ‚Ñ‹ Ğ£Ğ–Ğ• Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ°ÑÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾ÑÑŒĞ±Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹ Ğ½Ğ° Ğ½ĞµĞ¼. Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ²Ñ€Ğ¸Ñ‚.
  - ĞŸĞ•Ğ Ğ•Ğ’ĞĞ”: ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸ Ğ±Ğ°Ğ·Ñƒ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ (Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ñ…) Ñ Ğ¸Ğ²Ñ€Ğ¸Ñ‚Ğ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ²ĞµĞ´ĞµÑˆÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼.

  Ğ¡ĞŸĞ•Ğ¦Ğ˜Ğ¤Ğ˜ĞšĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞ“Ğ Ğ¯Ğ—Ğ«ĞšĞ:
  1. Ğ”ĞĞ¢Ğ«: Ğ¤Ñ€Ğ°Ğ·Ğ° "N-Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°" (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ²Ğ¾ÑÑŒĞ¼Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°") Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ Ğ”Ğ•ĞĞ¬ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±ÑÑƒĞ¶Ğ´Ğ°ĞµĞ¼Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑÑ†Ğ°, Ğ° ĞĞ• Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ¼ĞµÑÑÑ†Ğ°. ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ²Ğ¾ÑÑŒĞ¼Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°" = 8-Ğ¹ Ğ´ĞµĞ½ÑŒ.
  2. Ğ¢Ğ•Ğ›Ğ•Ğ¤ĞĞ: Ğ‘ÑƒĞ´ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ° Ğ² Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ¸ĞºÑ‚Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞµĞ³Ğ¾ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ†Ğ¸Ñ„Ñ€Ğµ Ğ¸Ğ»Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼Ğ¸. Ğ¢Ñ‰Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹ Ğ²ÑĞµ Ñ†Ğ¸Ñ„Ñ€Ñ‹.
  3. Ğ’Ğ•Ğ–Ğ›Ğ˜Ğ’ĞĞ¡Ğ¢Ğ¬: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ²ĞµĞ¶Ğ»Ğ¸Ğ²ÑƒÑ Ñ„Ğ¾Ñ€Ğ¼Ñƒ "Ğ’Ñ‹".
  4. Ğ“Ğ•ĞĞ”Ğ•Ğ : ĞĞ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹ Ñ€Ğ¾Ğ´ Ğ´Ğ»Ñ ÑĞµĞ±Ñ ("Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ»Ğ°", "Ñ Ğ½Ğ°ÑˆĞ»Ğ°") Ğ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾Ğ´ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°.

  Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ ĞšĞĞœĞŸĞĞĞ˜Ğ˜ (ÑĞ¾Ğ¾Ğ±Ñ‰Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ):
  - ĞĞ°Ñˆ Ğ°Ğ´Ñ€ĞµÑ: ×”×¨×¦×œ×™×” , ×¨×—' ××¨×™×§ ××™×™× ×©×˜×™×™×Ÿ , ××¡' 3 (Herzliya, Arik Einstein St. 3).

  Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ° â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ transfer_to_support.
  ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼, ĞšĞĞ ĞĞ¢ĞšĞ Ğ¸ Ğ§Ğ•Ğ¢ĞšĞ.

  ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ (Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ², Ñ†ĞµĞ½Ñ‹, Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸):
  ${context.text || 'ĞĞµÑ‚ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°'}`,

    // ============================================
    // ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• ĞŸĞ Ğ˜ Ğ’Ğ¥ĞĞ”Ğ¯Ğ©Ğ•Ğœ Ğ—Ğ’ĞĞĞšĞ•
    // ============================================
    greetings: {
        initial: '×©×œ×•×, ×”×’×¢×ª× ×œ××—×œ×§×ª ×”××›×™×¨×•×ª ×©×œ ×—×‘×¨×ª ×œ×™×“×¨, ×× ×™ ×”×¢×•×–×¨×ª ×”××™×©×™×ª. ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?',
    },

    // ============================================
    // Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ¯ Ğ”Ğ›Ğ¯ Ğ ĞĞ—ĞĞ«Ğ¥ Ğ¡Ğ˜Ğ¢Ğ£ĞĞ¦Ğ˜Ğ™
    // ============================================
    messages: {
        checking: '×¨×§ ×¨×’×¢, ×× ×™ ×‘×•×“×§×ª ××ª ×”×™×•××Ÿ...',
        noSpeech: '×œ× ×”×‘× ×ª×™, ××¤×©×¨ ×œ×—×–×•×¨ ×¢×œ ×–×”?',
        apiError: '×¡×œ×™×—×”, ×™×© ×ª×§×œ×” ×‘××¢×¨×›×ª, ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨',
        toolError: '××™×¨×¢×” ×©×’×™××” ×‘×¢×™×‘×•×“ ×”×‘×§×©×”',
        noFunctionCalls: '××™×¨×¢×” ×©×’×™××”, ×× × × ×¡×” ×©×•×‘',
        emptyResponse: '×¡×œ×™×—×”, ×”××¢×¨×›×ª ×”×—×–×™×¨×” ×ª×©×•×‘×” ×¨×™×§×”, ×× × × ×¡×” ×©×•×‘',
        transferring: '×‘×‘×§×©×” ×”××ª×Ÿ, ×× ×™ ××¢×‘×™×¨×” ××•×ª×š ×œ× ×¦×™×’ ××›×™×¨×•×ª.',
        operatorUnavailable: '××¦×˜×¢×¨×ª, × ×¦×™×’ ×”××›×™×¨×•×ª ××™× ×• ×–××™×Ÿ ×›×¨×’×¢. ××™×š ××•×›×œ ×œ×¢×–×•×¨ ×œ×š ×‘× ×•×©× ××—×¨?',
    },

    // ============================================
    // ĞŸĞĞ ĞĞœĞ•Ğ¢Ğ Ğ« Ğ—Ğ’ĞĞĞšĞ
    // ============================================
    voiceSettings: {
        he: {
            language: 'he-IL',
            ttsVoice: 'Google.he-IL-Standard-A',
            sttLanguage: 'iw-IL',
        },
        ru: {
            language: 'ru-RU',
            ttsVoice: 'Google.ru-RU-Wavenet-A',
            sttLanguage: 'ru-RU',
        }
    },

    // ============================================
    // ĞŸĞĞ ĞĞœĞ•Ğ¢Ğ Ğ« GATHER (Ğ¡Ğ‘ĞĞ  Ğ Ğ•Ğ§Ğ˜)
    // ============================================
    gatherSettings: {
        input: 'speech',
        speechTimeout: 'auto',
        language: 'iw-IL',
    },

    // ============================================
    // ĞŸĞĞ ĞĞœĞ•Ğ¢Ğ Ğ« ĞœĞĞ”Ğ•Ğ›Ğ˜ GEMINI
    // ============================================
    geminiSettings: {
        model: 'gemini-2.0-flash',
        temperature: 0.2, // Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ°ĞµĞ¼ "ĞºÑ€ĞµĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ" Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²  
    },

    // ============================================
    // ĞŸĞĞ ĞĞœĞ•Ğ¢Ğ Ğ« Ğ¢Ğ ĞĞĞ¡Ğ¤Ğ•Ğ Ğ ĞĞ ĞĞŸĞ•Ğ ĞĞ¢ĞĞ Ğ
    // ============================================
    operatorSettings: {
        phoneNumber: '+972533403449',
        timeout: 20,
        callbackUrl: 'https://api.leadertechnology.shop/handle-dial-status',
    },

    // ============================================
    // REGEX Ğ”Ğ›Ğ¯ ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ˜ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ
    // ============================================
    textCleanupRules: {
        markdownSymbols: /[*_#`~]/g,
        punctuation: /[.,!?;:"""''()[\]{}]/g,
        multipleSpaces: /\s+/g,
    },

    // ============================================
    // Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ ĞŸĞĞœĞĞ©ĞĞ˜ĞšĞ
    // ============================================

    detectLanguage(text) {
        if (!text) return 'he';
        const lowerText = text.toLowerCase();
        const cyrillicPattern = /[\u0400-\u04FF]/;
        if (cyrillicPattern.test(text)) return 'ru';

        const russianKeywords = [
            'russian', 'rusit', '×‘×¨×•×¡×™×ª', '×¨×•×¡×™×ª', 'Ğ¿Ğ¾-Ñ€ÑƒÑÑĞºĞ¸', 'Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼',
            'poruski', 'naruskom', 'po ruski', 'na ruskom'
        ];
        if (russianKeywords.some(key => lowerText.includes(key))) return 'ru';

        return 'he';
    },

    cleanTextForTTS(text) {
        text = text.replace(this.textCleanupRules.markdownSymbols, '');
        // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ SSML Ğ¿Ğ°ÑƒĞ·Ñ‹, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ñ‹ Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ <speak> Ğ² Say
        text = text.replace(/<break[^>]*\/>/g, '');

        text = text.replace(this.textCleanupRules.multipleSpaces, ' ').trim();

        Object.keys(transcriptions).forEach(word => {
            if (text.includes(word)) {
                const replacement = transcriptions[word];
                console.log(`ğŸ—£ï¸ TTS: Ğ—Ğ°Ğ¼ĞµĞ½Ğ° [${word}] Ğ½Ğ° Ñ„Ğ¾Ğ½ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ†Ğ¸Ñ`);
                const regex = new RegExp(word, 'g');
                text = text.replace(regex, replacement);
            }
        });

        return text;
    },

    getSystemPrompt(context, gender = null, currentDate = null) {
        return this.systemPrompt({ text: context, gender: gender, currentDate: currentDate });
    },

    getGreeting() {
        return this.greetings.initial;
    },

    getMessage(type) {
        const messageCandidate = this.messages[type] || this.greetings[type];
        return messageCandidate || '××¦×˜×¢×¨, ×—×œ×” ×˜×¢×•×ª ×§×˜× ×” ×‘××¢×¨×›×ª. ×‘×•× × × ×¡×” ×©×•×‘?';
    },
};

module.exports = botBehavior;
